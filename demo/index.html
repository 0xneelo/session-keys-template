<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Symmio Session Keys - Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <span class="logo-icon">üîê</span>
        <span class="logo-text">Session Keys</span>
      </div>
      <div class="network-badge" id="networkBadge">
        <span class="network-dot"></span>
        <span id="networkName">Not Connected</span>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Step 1: Create Session Key -->
      <section class="card" id="createKeySection">
        <div class="card-header">
          <span class="step-number">1</span>
          <h2>Create Session Key</h2>
        </div>
        <div class="card-content">
          <p class="description">
            Generate a new session key that will be stored encrypted in your browser.
            This key can sign transactions without exposing your main wallet.
          </p>
          
          <div class="form-group">
            <label for="password">Encryption Password</label>
            <input type="password" id="password" placeholder="Min 8 characters" minlength="8">
          </div>
          
          <div class="form-group">
            <label for="expiry">Key Expiry</label>
            <select id="expiry">
              <option value="3600">1 Hour</option>
              <option value="86400" selected>24 Hours</option>
              <option value="604800">7 Days</option>
            </select>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="withMnemonic">
            <label for="withMnemonic">Generate with mnemonic backup</label>
          </div>

          <button class="btn btn-primary" id="createKeyBtn">
            <span class="btn-icon">‚ú®</span>
            Create Session Key
          </button>
        </div>
      </section>

      <!-- Session Key Info -->
      <section class="card" id="keyInfoSection" style="display: none;">
        <div class="card-header">
          <span class="step-number">‚úì</span>
          <h2>Your Session Key</h2>
          <span class="key-status" id="keyStatus">Locked</span>
        </div>
        <div class="card-content">
          <div class="key-details">
            <div class="key-field">
              <label>Address</label>
              <div class="address-display">
                <code id="keyAddress">-</code>
                <button class="btn-icon-only" onclick="copyToClipboard('keyAddress')" title="Copy">üìã</button>
              </div>
            </div>
            <div class="key-field">
              <label>Balance</label>
              <div class="balance-display">
                <span id="keyBalance">0.0000</span> ETH
                <button class="btn-icon-only" onclick="refreshBalance()" title="Refresh">üîÑ</button>
              </div>
            </div>
            <div class="key-field">
              <label>Expires</label>
              <span id="keyExpiry">-</span>
            </div>
          </div>

          <!-- Mnemonic Display (only shown once) -->
          <div class="mnemonic-display" id="mnemonicDisplay" style="display: none;">
            <div class="mnemonic-warning">
              ‚ö†Ô∏è Write down this phrase! It won't be shown again.
            </div>
            <div class="mnemonic-words" id="mnemonicWords"></div>
            <button class="btn btn-secondary" onclick="hideMnemonic()">I've saved it</button>
          </div>

          <div class="key-actions">
            <div class="form-group inline">
              <input type="password" id="unlockPassword" placeholder="Enter password to unlock">
              <button class="btn btn-secondary" id="unlockBtn">üîì Unlock</button>
            </div>
            <div class="key-actions-row">
              <button class="btn btn-secondary" id="showQrBtn">üì± Sync to Mobile</button>
              <button class="btn btn-danger" id="deleteKeyBtn">üóëÔ∏è Delete Key</button>
            </div>
          </div>

          <!-- QR Code Modal -->
          <div class="qr-modal" id="qrModal" style="display: none;">
            <div class="qr-modal-content">
              <div class="qr-modal-header">
                <h3>üì± Sync Session Key</h3>
                <button class="btn-close" id="closeQrModal">‚úï</button>
              </div>
              <div class="qr-tabs">
                <button class="qr-tab active" data-tab="show">Show QR Code</button>
                <button class="qr-tab" data-tab="scan">Scan QR Code</button>
              </div>
              
              <!-- Show QR Tab -->
              <div class="qr-tab-content active" id="showQrTab">
                <p class="qr-description">
                  Scan this QR code with your other device to sync your session key.
                  <strong>You'll need your password to unlock it.</strong>
                </p>
                <div class="qr-code-container">
                  <div id="qrCodeContainer"></div>
                </div>
                <p class="qr-hint">‚ö†Ô∏è The QR contains encrypted data - your password is still required</p>
              </div>
              
              <!-- Scan QR Tab -->
              <div class="qr-tab-content" id="scanQrTab">
                <p class="qr-description">
                  Point your camera at a session key QR code to import it.
                </p>
                <div class="scanner-container">
                  <video id="scannerVideo" autoplay playsinline></video>
                  <canvas id="scannerCanvas" style="display: none;"></canvas>
                  <div class="scanner-overlay">
                    <div class="scanner-frame"></div>
                  </div>
                </div>
                <div class="scanner-controls">
                  <button class="btn btn-primary" id="startScanBtn">üì∑ Start Camera</button>
                  <button class="btn btn-secondary" id="stopScanBtn" style="display: none;">‚èπÔ∏è Stop</button>
                </div>
                <div class="scan-result" id="scanResult" style="display: none;"></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Import Session Key (shown when no key exists) -->
      <section class="card" id="importKeySection" style="display: none;">
        <div class="card-header">
          <span class="step-number">üì•</span>
          <h2>Import Session Key</h2>
        </div>
        <div class="card-content">
          <p class="description">
            Scan a QR code from another device to import an existing session key.
          </p>
          <button class="btn btn-primary" id="openScannerBtn">
            <span class="btn-icon">üì∑</span>
            Scan QR Code
          </button>
        </div>
      </section>

      <!-- Step 2: Get Testnet ETH -->
      <section class="card" id="faucetSection">
        <div class="card-header">
          <span class="step-number">2</span>
          <h2>Get Testnet ETH</h2>
        </div>
        <div class="card-content">
          <p class="description">
            You'll need testnet ETH to send transactions. Use one of these faucets:
          </p>
          
          <div class="faucet-links">
            <a href="https://sepoliafaucet.com/" target="_blank" class="faucet-link">
              <span class="faucet-icon">üö∞</span>
              <div>
                <strong>Sepolia Faucet</strong>
                <span>sepoliafaucet.com</span>
              </div>
            </a>
            <a href="https://www.alchemy.com/faucets/ethereum-sepolia" target="_blank" class="faucet-link">
              <span class="faucet-icon">‚öóÔ∏è</span>
              <div>
                <strong>Alchemy Faucet</strong>
                <span>alchemy.com</span>
              </div>
            </a>
            <a href="https://cloud.google.com/application/web3/faucet/ethereum/sepolia" target="_blank" class="faucet-link">
              <span class="faucet-icon">‚òÅÔ∏è</span>
              <div>
                <strong>Google Cloud Faucet</strong>
                <span>cloud.google.com</span>
              </div>
            </a>
          </div>
        </div>
      </section>

      <!-- Step 3: Sign Message -->
      <section class="card" id="signSection">
        <div class="card-header">
          <span class="step-number">3</span>
          <h2>Sign a Message</h2>
        </div>
        <div class="card-content">
          <p class="description">
            Test signing a message with your session key (no gas required).
          </p>
          
          <div class="form-group">
            <label for="messageToSign">Message</label>
            <textarea id="messageToSign" placeholder="Enter a message to sign...">Hello from Symmio Session Keys!</textarea>
          </div>

          <button class="btn btn-primary" id="signMessageBtn" disabled>
            <span class="btn-icon">‚úçÔ∏è</span>
            Sign Message
          </button>

          <div class="signature-result" id="signatureResult" style="display: none;">
            <label>Signature</label>
            <code id="signatureOutput"></code>
          </div>
        </div>
      </section>

      <!-- Step 4: Send Transaction -->
      <section class="card" id="sendSection">
        <div class="card-header">
          <span class="step-number">4</span>
          <h2>Send Transaction</h2>
        </div>
        <div class="card-content">
          <p class="description">
            Send testnet ETH to the specified address using your session key.
          </p>
          
          <div class="form-group">
            <label for="recipientAddress">Recipient Address</label>
            <input type="text" id="recipientAddress" value="0x83B285E802D76055169B1C5e3bF21702B85b89Cb" readonly>
          </div>

          <div class="form-group">
            <label for="sendAmount">Amount (ETH)</label>
            <input type="number" id="sendAmount" value="0.001" step="0.0001" min="0">
          </div>

          <div class="form-group">
            <label for="txMessage">Message (optional - will be visible on Etherscan!)</label>
            <input type="text" id="txMessage" placeholder="e.g. Hello from Session Keys!" maxlength="100">
            <small class="input-hint">This message will be encoded in the transaction data</small>
          </div>

          <div class="gas-sponsor-option" id="gasSponsorOption" style="display: none;">
            <div class="checkbox-group">
              <input type="checkbox" id="useGasSponsor">
              <label for="useGasSponsor">
                ‚õΩ Use Gas Sponsor (no ETH needed in session key!)
              </label>
            </div>
            <div class="sponsor-status" id="sponsorStatus"></div>
            <div class="donate-section" id="donateSection" style="display: none;">
              <div class="donate-row">
                <input type="number" id="donateAmount" placeholder="Amount" step="0.001" min="0">
                <button class="btn btn-secondary" id="donateAllBtn">Max</button>
                <button class="btn btn-primary" id="donateBtn">üí∞ Donate to Pool</button>
              </div>
              <small class="input-hint">Donate your session key's ETH to the gas sponsor pool</small>
            </div>
          </div>

          <button class="btn btn-primary" id="sendTxBtn" disabled>
            <span class="btn-icon">üì§</span>
            Send Transaction
          </button>

          <div class="tx-result" id="txResult" style="display: none;">
            <div class="tx-status" id="txStatus"></div>
            <a href="#" id="txLink" target="_blank" class="tx-link">View on Etherscan ‚Üí</a>
          </div>
        </div>
      </section>
    </main>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>
  </div>

  <!-- QR Code Libraries (using cdnjs for reliability) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
  
  <!-- Scripts -->
  <script type="module" src="app.js"></script>
</body>
</html>
