<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Symmio Session Keys - Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-layout">
    <!-- Top Navigation Bar -->
    <nav class="navbar">
      <div class="navbar-brand">
        <span class="logo-icon">ğŸ”</span>
        <span class="logo-text">Session Keys</span>
      </div>

      <div class="navbar-center">
        <!-- Session Key Selector -->
        <div class="session-selector" id="sessionSelector">
          <div class="session-info" id="sessionInfo">
            <span class="session-status" id="sessionStatus">â—</span>
            <span class="session-address" id="navKeyAddress">No Session Key</span>
            <span class="session-balance" id="navKeyBalance"></span>
          </div>
          <button class="btn btn-sm btn-secondary" id="navUnlockBtn" style="display: none;">ğŸ”“</button>
        </div>
      </div>

      <div class="navbar-actions">
        <button class="btn btn-sm btn-accent" id="claimEthBtn" title="Get testnet ETH">
          ğŸš° Claim ETH
        </button>
        <button class="btn btn-sm btn-primary" id="donateNavBtn" title="Donate to gas pool" style="display: none;">
          ğŸ’° Donate
        </button>
        <div class="network-badge" id="networkBadge">
          <span class="network-dot"></span>
          <span id="networkName">Sepolia</span>
        </div>
      </div>
    </nav>

    <div class="app-body">
      <!-- Sidebar -->
      <aside class="sidebar">
        <nav class="sidebar-nav">
          <button class="nav-item active" data-section="session">
            <span class="nav-icon">ğŸ”‘</span>
            <span class="nav-label">Session Key</span>
          </button>
          <button class="nav-item" data-section="sign">
            <span class="nav-icon">âœï¸</span>
            <span class="nav-label">Sign Message</span>
          </button>
          <button class="nav-item" data-section="send">
            <span class="nav-icon">ğŸ“¤</span>
            <span class="nav-label">Send Transaction</span>
          </button>
          <button class="nav-item" data-section="gas">
            <span class="nav-icon">â›½</span>
            <span class="nav-label">Gas Sponsor</span>
          </button>
          <button class="nav-item" data-section="sync">
            <span class="nav-icon">ğŸ“±</span>
            <span class="nav-label">Sync Device</span>
          </button>
        </nav>

        <div class="sidebar-footer">
          <a href="https://github.com/0xneelo/session-keys-template" target="_blank" class="sidebar-link">
            ğŸ“‚ GitHub
          </a>
          <a href="https://docs.symm.io" target="_blank" class="sidebar-link">
            ğŸ“š Docs
          </a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Session Key Section -->
        <section class="content-section active" id="sectionSession">
          <div class="section-header">
            <h1>Session Key Management</h1>
            <p>Create, manage, and unlock your session keys</p>
          </div>

          <!-- Create Key Card -->
          <div class="card" id="createKeyCard">
            <div class="card-header">
              <h2>âœ¨ Create New Session Key</h2>
            </div>
            <div class="card-body">
              <p class="card-description">
                Generate a new session key that will be stored encrypted in your browser.
              </p>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="password">Encryption Password</label>
                  <input type="password" id="password" placeholder="Min 8 characters" minlength="8">
                </div>
                <div class="form-group">
                  <label for="expiry">Key Expiry</label>
                  <select id="expiry">
                    <option value="3600">1 Hour</option>
                    <option value="86400" selected>24 Hours</option>
                    <option value="604800">7 Days</option>
                  </select>
                </div>
              </div>

              <div class="checkbox-group">
                <input type="checkbox" id="withMnemonic">
                <label for="withMnemonic">Generate with mnemonic backup phrase</label>
              </div>

              <button class="btn btn-primary btn-lg" id="createKeyBtn">
                Create Session Key
              </button>
            </div>
          </div>

          <!-- Key Info Card -->
          <div class="card" id="keyInfoCard" style="display: none;">
            <div class="card-header">
              <h2>ğŸ”‘ Your Session Key</h2>
              <span class="status-badge" id="keyStatus">Locked</span>
            </div>
            <div class="card-body">
              <div class="key-grid">
                <div class="key-stat">
                  <label>Address</label>
                  <div class="stat-value">
                    <code id="keyAddress">-</code>
                    <button class="btn-icon" onclick="copyToClipboard('keyAddress')" title="Copy">ğŸ“‹</button>
                  </div>
                </div>
                <div class="key-stat">
                  <label>Balance</label>
                  <div class="stat-value">
                    <span id="keyBalance">0.0000</span> ETH
                    <button class="btn-icon" onclick="refreshBalance()" title="Refresh">ğŸ”„</button>
                  </div>
                </div>
                <div class="key-stat">
                  <label>Expires</label>
                  <div class="stat-value">
                    <span id="keyExpiry">-</span>
                  </div>
                </div>
              </div>

              <!-- Mnemonic Display -->
              <div class="mnemonic-display" id="mnemonicDisplay" style="display: none;">
                <div class="mnemonic-warning">
                  âš ï¸ Write down this phrase! It won't be shown again.
                </div>
                <div class="mnemonic-words" id="mnemonicWords"></div>
                <button class="btn btn-secondary" onclick="hideMnemonic()">I've saved it</button>
              </div>

              <!-- Unlock Form -->
              <div class="unlock-form" id="unlockForm">
                <input type="password" id="unlockPassword" placeholder="Enter password to unlock">
                <button class="btn btn-primary" id="unlockBtn">ğŸ”“ Unlock</button>
              </div>

              <!-- Key Actions -->
              <div class="key-actions" id="keyActions" style="display: none;">
                <button class="btn btn-secondary" id="showQrBtn">ğŸ“± Sync to Mobile</button>
                <button class="btn btn-danger" id="deleteKeyBtn">ğŸ—‘ï¸ Delete Key</button>
              </div>
            </div>
          </div>

          <!-- Import Key Card -->
          <div class="card" id="importKeyCard" style="display: none;">
            <div class="card-header">
              <h2>ğŸ“¥ Import Session Key</h2>
            </div>
            <div class="card-body">
              <p class="card-description">
                Scan a QR code from another device to import an existing session key.
              </p>
              <button class="btn btn-primary" id="openScannerBtn">
                ğŸ“· Scan QR Code
              </button>
            </div>
          </div>
        </section>

        <!-- Sign Message Section -->
        <section class="content-section" id="sectionSign">
          <div class="section-header">
            <h1>Sign Message</h1>
            <p>Cryptographically sign a message with your session key (no gas required)</p>
          </div>

          <div class="card">
            <div class="card-body">
              <div class="form-group">
                <label for="messageToSign">Message to Sign</label>
                <textarea id="messageToSign" rows="4" placeholder="Enter a message to sign...">Hello World! This message was sent using Session Keys.</textarea>
              </div>

              <button class="btn btn-primary btn-lg" id="signMessageBtn" disabled>
                âœï¸ Sign Message
              </button>

              <div class="result-box" id="signatureResult" style="display: none;">
                <label>Signature</label>
                <code id="signatureOutput"></code>
                <button class="btn-icon" onclick="copyToClipboard('signatureOutput')" title="Copy">ğŸ“‹</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Send Transaction Section -->
        <section class="content-section" id="sectionSend">
          <div class="section-header">
            <h1>Send Transaction</h1>
            <p>Send testnet ETH using your session key</p>
          </div>

          <div class="card">
            <div class="card-body">
              <div class="form-group">
                <label for="recipientAddress">Recipient Address</label>
                <input type="text" id="recipientAddress" value="0x83B285E802D76055169B1C5e3bF21702B85b89Cb">
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="sendAmount">Amount (ETH)</label>
                  <input type="number" id="sendAmount" value="0.001" step="0.0001" min="0">
                </div>
                <div class="form-group">
                  <label for="txMessage">On-chain Message</label>
                  <input type="text" id="txMessage" value="Hello World! This message was sent using Session Keys." maxlength="100">
                </div>
              </div>

              <div class="checkbox-group" id="gasSponsorCheckbox" style="display: none;">
                <input type="checkbox" id="useGasSponsor">
                <label for="useGasSponsor">â›½ Use Gas Sponsor (no ETH needed!)</label>
              </div>

              <button class="btn btn-primary btn-lg" id="sendTxBtn" disabled>
                ğŸ“¤ Send Transaction
              </button>

              <div class="result-box success" id="txResult" style="display: none;">
                <div class="tx-status" id="txStatus"></div>
                <a href="#" id="txLink" target="_blank" class="tx-link">View on Etherscan â†’</a>
              </div>
            </div>
          </div>
        </section>

        <!-- Gas Sponsor Section -->
        <section class="content-section" id="sectionGas">
          <div class="section-header">
            <h1>Gas Sponsor</h1>
            <p>Manage gas sponsorship for gasless transactions</p>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>â›½ Gas Pool Status</h2>
            </div>
            <div class="card-body">
              <div class="gas-stats" id="gasStats">
                <div class="gas-stat">
                  <label>Pool Balance</label>
                  <span class="stat-value" id="gasPoolBalance">-</span>
                </div>
                <div class="gas-stat">
                  <label>Your Budget</label>
                  <span class="stat-value" id="gasBudget">-</span>
                </div>
                <div class="gas-stat">
                  <label>Status</label>
                  <span class="stat-value" id="gasStatus">-</span>
                </div>
              </div>

              <div class="sponsor-status" id="sponsorStatus"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>ğŸ’° Donate to Pool</h2>
            </div>
            <div class="card-body">
              <p class="card-description">
                Donate your session key's ETH to the gas sponsor pool. This helps everyone use gasless transactions!
              </p>
              <div class="form-row">
                <div class="form-group flex-grow">
                  <label for="donateAmount">Amount (ETH)</label>
                  <input type="number" id="donateAmount" placeholder="0.01" step="0.001" min="0">
                </div>
                <div class="form-group">
                  <label>&nbsp;</label>
                  <button class="btn btn-secondary" id="donateAllBtn">Max</button>
                </div>
              </div>
              <button class="btn btn-primary btn-lg" id="donateBtn">
                ğŸ’° Donate to Gas Pool
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h2>ğŸš° Get Testnet ETH</h2>
            </div>
            <div class="card-body">
              <div class="faucet-grid">
                <a href="https://sepoliafaucet.com/" target="_blank" class="faucet-card">
                  <span class="faucet-icon">ğŸš°</span>
                  <strong>Sepolia Faucet</strong>
                  <span>sepoliafaucet.com</span>
                </a>
                <a href="https://www.alchemy.com/faucets/ethereum-sepolia" target="_blank" class="faucet-card">
                  <span class="faucet-icon">âš—ï¸</span>
                  <strong>Alchemy Faucet</strong>
                  <span>alchemy.com</span>
                </a>
                <a href="https://cloud.google.com/application/web3/faucet/ethereum/sepolia" target="_blank" class="faucet-card">
                  <span class="faucet-icon">â˜ï¸</span>
                  <strong>Google Cloud</strong>
                  <span>cloud.google.com</span>
                </a>
              </div>
            </div>
          </div>
        </section>

        <!-- Sync Device Section -->
        <section class="content-section" id="sectionSync">
          <div class="section-header">
            <h1>Sync Device</h1>
            <p>Transfer your session key to another device using QR codes</p>
          </div>

          <div class="sync-grid">
            <div class="card">
              <div class="card-header">
                <h2>ğŸ“¤ Export to Device</h2>
              </div>
              <div class="card-body centered">
                <p class="card-description">
                  Show a QR code to scan with your other device.
                  <strong>Your password is still required to unlock.</strong>
                </p>
                <div class="qr-code-container" id="exportQrContainer">
                  <div id="qrCodeContainer"></div>
                </div>
                <button class="btn btn-primary" id="generateQrBtn">Generate QR Code</button>
                <p class="qr-hint">âš ï¸ The QR contains encrypted data</p>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h2>ğŸ“¥ Import from Device</h2>
              </div>
              <div class="card-body centered">
                <p class="card-description">
                  Scan a QR code from another device to import a session key.
                </p>
                <div class="scanner-container" id="syncScannerContainer">
                  <video id="scannerVideo" autoplay playsinline></video>
                  <canvas id="scannerCanvas" style="display: none;"></canvas>
                  <div class="scanner-overlay">
                    <div class="scanner-frame"></div>
                  </div>
                </div>
                <div class="scanner-controls">
                  <button class="btn btn-primary" id="startScanBtn">ğŸ“· Start Camera</button>
                  <button class="btn btn-secondary" id="stopScanBtn" style="display: none;">â¹ï¸ Stop</button>
                </div>
                <div class="scan-result" id="scanResult" style="display: none;"></div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Unlock Modal -->
    <div class="modal" id="unlockModal" style="display: none;">
      <div class="modal-content">
        <h3>ğŸ”“ Unlock Session Key</h3>
        <p>Enter your password to unlock the session key</p>
        <input type="password" id="modalUnlockPassword" placeholder="Password">
        <div class="modal-actions">
          <button class="btn btn-secondary" id="modalCancelBtn">Cancel</button>
          <button class="btn btn-primary" id="modalUnlockBtn">Unlock</button>
        </div>
      </div>
    </div>

    <!-- Faucet Modal -->
    <div class="modal" id="faucetModal" style="display: none;">
      <div class="modal-content">
        <h3>ğŸš° Get Testnet ETH</h3>
        <p>Choose a faucet to get free testnet ETH:</p>
        <div class="faucet-grid">
          <a href="https://sepoliafaucet.com/" target="_blank" class="faucet-card" onclick="closeFaucetModal()">
            <span class="faucet-icon">ğŸš°</span>
            <strong>Sepolia Faucet</strong>
          </a>
          <a href="https://www.alchemy.com/faucets/ethereum-sepolia" target="_blank" class="faucet-card" onclick="closeFaucetModal()">
            <span class="faucet-icon">âš—ï¸</span>
            <strong>Alchemy</strong>
          </a>
          <a href="https://cloud.google.com/application/web3/faucet/ethereum/sepolia" target="_blank" class="faucet-card" onclick="closeFaucetModal()">
            <span class="faucet-icon">â˜ï¸</span>
            <strong>Google Cloud</strong>
          </a>
        </div>
        <p class="modal-hint">Your session key address: <code id="faucetAddress">-</code></p>
        <button class="btn btn-secondary" onclick="closeFaucetModal()">Close</button>
      </div>
    </div>
  </div>

  <!-- QR Code Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
  
  <!-- Scripts -->
  <script type="module" src="app.js"></script>
</body>
</html>
